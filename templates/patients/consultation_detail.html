{% extends 'base.html' %}

{% block title %}Consultation Details{% endblock %}
{% block page_title %}Consultation Details{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-8">
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between">
                <span><i class="bi bi-stethoscope"></i> Consultation Notes</span>
                <a href="{% url 'patients:consultation_edit' consultation.pk %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil"></i> Edit
                </a>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-2">
                        <strong>BP</strong><br>{{ consultation.vitals_bp|default:"-" }}
                    </div>
                    <div class="col-md-2">
                        <strong>Pulse</strong><br>{{ consultation.vitals_pulse|default:"-" }} bpm
                    </div>
                    <div class="col-md-2">
                        <strong>Temp</strong><br>{{ consultation.vitals_temp|default:"-" }} Â°C
                    </div>
                    <div class="col-md-3">
                        <strong>Weight</strong><br>{{ consultation.vitals_weight|default:"-" }} kg
                    </div>
                    <div class="col-md-3">
                        <strong>Height</strong><br>{{ consultation.vitals_height|default:"-" }} cm
                    </div>
                </div>
                
                <h6>Chief Complaint</h6>
                <p class="border-start border-3 border-primary ps-3">{{ consultation.chief_complaint }}</p>
                
                {% if consultation.history_of_illness %}
                <h6>History of Present Illness</h6>
                <p>{{ consultation.history_of_illness }}</p>
                {% endif %}
                
                {% if consultation.examination_findings %}
                <h6>Examination Findings</h6>
                <p>{{ consultation.examination_findings }}</p>
                {% endif %}
                
                <h6>Diagnosis</h6>
                <p class="border-start border-3 border-success ps-3">{{ consultation.diagnosis }}</p>
                
                {% if consultation.treatment_plan %}
                <h6>Treatment Plan</h6>
                <p>{{ consultation.treatment_plan }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <span><i class="bi bi-capsule"></i> Prescriptions</span>
                <a href="{% url 'patients:prescription_add' consultation.pk %}" class="btn btn-sm btn-primary">
                    <i class="bi bi-plus"></i> Add Medicine
                </a>
            </div>
            <div class="card-body p-0">
                <table class="table mb-0">
                    <thead>
                        <tr>
                            <th>Medicine</th>
                            <th>Dosage</th>
                            <th>Frequency</th>
                            <th>Duration</th>
                            <th>Qty</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for rx in prescriptions %}
                        <tr>
                            <td>{{ rx.medicine.name }}</td>
                            <td>{{ rx.dosage }}</td>
                            <td>{{ rx.frequency }}</td>
                            <td>{{ rx.duration }}</td>
                            <td>{{ rx.quantity }}</td>
                            <td>
                                {% if rx.is_dispensed %}
                                <span class="badge bg-success">Dispensed</span>
                                {% else %}
                                <span class="badge bg-warning">Pending</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">No prescriptions added.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">Patient Info</div>
            <div class="card-body">
                <h6><a href="{% url 'patients:patient_detail' consultation.visit.patient.pk %}">{{ consultation.visit.patient.full_name }}</a></h6>
                <p class="text-muted">{{ consultation.visit.patient.patient_id }}</p>
                <p><strong>Age:</strong> {{ consultation.visit.patient.age }} years</p>
                <p><strong>Visit:</strong> <a href="{% url 'patients:visit_detail' consultation.visit.pk %}">{{ consultation.visit.visit_number }}</a></p>
                <p><strong>Doctor:</strong> {{ consultation.doctor.get_full_name }}</p>
                <p><strong>Date:</strong> {{ consultation.created_at|date:"M d, Y H:i" }}</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
