{% extends 'base.html' %}

{% block title %}Visits{% endblock %}
{% block page_title %}Today's Visits{% endblock %}

{% block content %}
<div class="page-header">
    <h4><i class="bi bi-clipboard2-pulse"></i> Visits</h4>
    <a href="{% url 'patients:visit_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> New Visit
    </a>
</div>

<div class="card mb-4">
    <div class="card-body py-3">
        <form method="get">
            <div class="row align-items-end g-3">
                <div class="col-md-4">
                    <label class="form-label">Date Filter</label>
                    <input type="date" name="date" class="form-control" value="{{ date_filter }}">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-outline-primary">
                        <i class="bi bi-funnel"></i> Filter
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-body p-0">
        <table class="table table-hover data-table">
            <thead>
                <tr>
                    <th>Queue</th>
                    <th>Visit #</th>
                    <th>Patient</th>
                    <th>Type</th>
                    <th>Doctor</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for visit in visits %}
                <tr>
                    <td>
                        <span class="queue-badge">#{{ visit.queue_number }}</span>
                    </td>
                    <td><code class="visit-code">{{ visit.visit_number }}</code></td>
                    <td>
                        <a href="{% url 'patients:patient_detail' visit.patient.pk %}" class="patient-link">
                            {{ visit.patient.full_name }}
                        </a>
                    </td>
                    <td>
                        <span class="type-badge {{ visit.visit_type|lower }}">{{ visit.get_visit_type_display }}</span>
                    </td>
                    <td>{{ visit.doctor.get_full_name|default:"-" }}</td>
                    <td>
                        <span class="status-badge {{ visit.status }}">{{ visit.get_status_display }}</span>
                    </td>
                    <td>
                        <div class="action-group">
                            <a href="{% url 'patients:visit_detail' visit.pk %}" class="action-btn view" title="View Details">
                                <i class="bi bi-eye"></i>
                            </a>
                            {% if visit.status != 'completed' %}
                            <a href="{% url 'patients:consultation_create' visit.pk %}" class="action-btn consult" title="Start Consultation">
                                <i class="bi bi-stethoscope"></i>
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <i class="bi bi-clipboard2"></i>
                            <p>No visits for this date.</p>
                            <a href="{% url 'patients:visit_create' %}" class="btn btn-primary btn-sm">
                                <i class="bi bi-plus-lg"></i> Create New Visit
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-lg);
    }
    .page-header h4 {
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }
    .page-header h4 i {
        color: var(--primary);
    }
    .queue-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        padding: 6px 12px;
        background: var(--secondary);
        color: var(--text-inverse);
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: var(--font-size-sm);
    }
    .visit-code {
        background: var(--primary-light);
        color: var(--primary);
        padding: 4px 10px;
        border-radius: var(--radius-sm);
        font-size: var(--font-size-sm);
        font-weight: 500;
    }
    .patient-link {
        color: var(--text-primary);
        font-weight: 500;
        text-decoration: none;
    }
    .patient-link:hover {
        color: var(--primary);
    }
    .type-badge {
        display: inline-flex;
        padding: 4px 12px;
        border-radius: var(--radius-full);
        font-size: var(--font-size-xs);
        font-weight: 500;
    }
    .type-badge.medical {
        background: var(--info-light);
        color: var(--info);
    }
    .type-badge.otc {
        background: var(--success-light);
        color: var(--success);
    }
    .action-group {
        display: flex;
        gap: var(--space-xs);
    }
    .action-btn {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-md);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text-secondary);
        transition: all var(--transition-fast);
    }
    .action-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--primary-light);
    }
    .action-btn.consult:hover {
        border-color: var(--success);
        color: var(--success);
        background: var(--success-light);
    }
    .empty-state {
        text-align: center;
        padding: var(--space-2xl) var(--space-lg);
        color: var(--text-secondary);
    }
    .empty-state i {
        font-size: 3rem;
        color: var(--text-muted);
        margin-bottom: var(--space-md);
        display: block;
    }
    .empty-state p {
        margin-bottom: var(--space-md);
    }
</style>
{% endblock %}
